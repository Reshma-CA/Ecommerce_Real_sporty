{% extends 'layouts/main.html'%}

{% load static %}

{% block custom_css %}
<style>
    /* Add this to your CSS styles or stylesheet */
    .cart-page-heading {
        text-align: center;
        font-size: 24px;
        margin-bottom: 20px;
    }
    
    .order-details-form {
        list-style: none;
        padding: 0;
    }
    
    .order-item {
        display: flex;
        background: #fff;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        margin-bottom: 20px;
        padding: 15px;
    }
    
    .item-image {
        flex: 0 0 100px;
        margin-right: 20px;
        img {
            max-width: 100%;
            height: auto;
        }
    }
    
    .item-details {
        flex: 1;
    }
    
    .item-name {
        font-size: 18px;
        font-weight: 600;
    }
    
    .item-quantity,
    .item-total {
        font-size: 16px;
    }
    
    .item-total {
        color: #ff5722;
        margin-top: 5px;
    }
    
    .cart-page-heading p {
        font-size: 16px;
        color: #777;
        margin-top: 5px;
    }
    /* Style the order summary */
.order-summary {
    background-color: #f9f9f9;
    border: 1px solid #ddd;
    padding: 20px;
    border-radius: 5px;
    margin-top: 20px;
    text-align: center;
}

.order-summary h3 {
    font-size: 20px;
    margin-bottom: 10px;
    color: #333;
}

.subtotal {
    font-size: 18px;
    margin-top: 10px;
}

.subtotal span {
    display: block;
}

.subtotal-amount {
    color: #ff5722;
    font-weight: bold;
    font-size: 24px;
}

/* Style the payment methods */
.payment-methods {
    text-align: center;
    margin-top: 30px;
}

.payment-methods h3 {
    font-size: 20px;
    margin-bottom: 10px;
    color: #333;
}

.payment-options {
    display: flex;
    justify-content: center;
}

.payment-options a {
    margin: 10px;
}


/* Styling for both buttons */
.btn.cash-on-delivery,
.btn.razor-pay {
    background-color: #ff5722; /* Orange background color for both buttons */
    color: #fff; /* White text color for both buttons */
    border: none;
    padding: 10px 20px; /* Padding to define button size */
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
    text-transform: uppercase; /* Uppercase text for both buttons */
    font-weight: bold; /* Bold text for both buttons */
    font-size: 16px;
}

.btn.cash-on-delivery:hover,
.btn.razor-pay:hover {
    background-color: #ff4500; /* Darker orange on hover for both buttons */
}

/*////////////////////////////////////////////////////////////*/

h3 {
    font-size: 24px;
    margin-bottom: 20px;
}

.subtotal {
    background-color: #f4f4f4;
    padding: 20px;
    border-radius: 10px;
    margin: 20px;
}

.subtotal span {
    display: block;
    font-size: 18px;
    margin: 5px 0;
}

.subtotal-amount {
    font-weight: bold;
}

.item-total {
    margin: 10px 0;
    font-size: 16px;
}

.block-title {
    font-size: 24px;
    margin-top: 20px;
}

.mb-4 {
    margin-bottom: 20px;
}

select.form-control {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    border: 2px solid #ccc;
    border-radius: 5px;
}

.apply-button {
    display: block;
    width: 100%;
    padding: 10px;
    background-color: #007bff;
    color: #fff;
    text-align: center;
    font-size: 18px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
}


    .custom-select-container {
        text-align: center;
    }

    .custom-select-container select {
        display: inline-block;
        text-align: left;
    }
</style>


    
</style>
{% endblock custom_css %}


{% block content %}

   <!-- ##### Header Area Start ##### -->
   <header class="header_area">
    <div class="classy-nav-container breakpoint-off d-flex align-items-center justify-content-between">
        <!-- Classy Menu -->
        <nav class="classy-navbar" id="essenceNav">
            <!-- Logo -->
            <a class="nav-brand" href="index.html"><img src="{% static '/img/core-img/Realsporty-logos_black.png'%}" width="125" height ="150" alt=""></a>
            <!-- Navbar Toggler -->
            <div class="classy-navbar-toggler">
                <span class="navbarToggler"><span></span><span></span><span></span></span>
            </div>
            <!-- Menu -->
            <div class="classy-menu">
                <!-- close btn -->
                <div class="classycloseIcon">
                    <div class="cross-wrap"><span class="top"></span><span class="bottom"></span></div>
                </div>
                <!-- Nav Start -->
                <div class="classynav">
                    <ul>
                      <li><a href="#">Home</a>
                        
                    </li>
                      <!-- #################################################### -->
                        <li><a href="#">Shop</a>
                            <div class="megamenu">
                                <ul class="single-mega cn-col-4">
                                    <li class="title">Collections </li>
                                    <li><a href="shop.html">Badminton Racket &amp; Cock </a></li>
                                    <li><a href="shop.html">Cricket Bat &amp; Ball</a></li>
                                    <li><a href="shop.html">Football</a></li>
                                    
                                </ul>
                              
                                <div class="single-mega cn-col-4">
                                    <img src="{% static '/img/bg-img/bgg-6.jpg'%}" alt="">
                                </div>
                            </div>
                        </li>
                        <!-- ############################################### -->
                        <li><a href="#">Pages</a>
                            <ul class="dropdown">
                                <li><a href="index.html">Home</a></li>
                                <li><a href="shop.html">Shop</a></li>
                                <li><a href="single-product-details.html">Product Details</a></li>
                                <li><a href="checkout.html">Checkout</a></li>
                                <li><a href="blog.html">Blog</a></li>
                                <li><a href="single-blog.html">Single Blog</a></li>
                                <li><a href="regular-page.html">Regular Page</a></li>
                                <li><a href="contact.html">Contact</a></li>
                            </ul>
                        </li>
                        
                        <li><a href="contact.html">Contact</a></li>
                        
                    </ul>
                </div>
                <!-- Nav End -->
            </div>
        </nav>

        <!-- Header Meta Data -->
        <div class="header-meta d-flex clearfix justify-content-end">
            <!-- Search Area -->
            <div class="search-area">
                {% comment %} <form action="#" method="post">
                    <input type="search" name="search" id="headerSearch" placeholder="Type for search">
                    <button type="submit"><i class="fa fa-search" aria-hidden="true"></i></button>
                </form> {% endcomment %}
            </div>
            <!-- Favourite Area -->
            <div class="favourite-area">
                <a href="{% url 'wishlist'%}"><img src="{% static '/img/core-img/heart.svg'%}" alt=""></a>
            </div>
            <!-- User Login Info -->
            <div class="user-login-info">
                <a href="{% url 'userprofile'%}"><img src="{% static '/img/core-img/user.svg'%}" alt=""></a>
            </div>
            <!-- Cart Area -->
            <div class="cart-area">
                <a href="{% url 'cart' %}" id="essenceCartBtn"><img src="{% static '/img/core-img/bag.svg'%}" alt=""> <span>3</span></a>
            </div>

            <div class="user-login-info">
              <a href="{% url 'logout' %}"><img src="{% static '/img/core-img/logout (1).png'%}" width="500" alt=""></a>
             
          </div>
        </div>

    </div>
</header>

    <!-- ##### Breadcumb Area Start ##### -->
    <div class="breadcumb_area bg-img" style="background-image: url('{% static 'img/bg-img/breadcumb.jpg '%}');" > 
        <div class="container h-100">
            <div class="row h-100 align-items-center"> 
                <div class="col-12">
                    <div class="page-title text-center">
                        <h2>Checkout</h2>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ##### Breadcumb Area End ##### -->

    <!-- ##### Checkout Area Start ##### -->
    <div class="checkout_area section-padding-80">
        <div class="container">
            <div class="row">

        
                <div class="cart-page-heading">
                    <h5>Your Order</h5>
                    <p>The Details</p>
                </div>

                <ul class="order-details-form mb-4">
                    {% for item in cartobj %}
                        
                            <li class="order-item">
                                <div class="item-details">
                                    <div class="item-name"> Item Name: {{ item.product.name }}</div>
                                    <div class="item-quantity"> Quantity: {{ item.quantity }}</div>
                                    <div class="item-total"> Product Price: {{ item.total|floatformat:2 }}</div>
                                    
                                     
                                </div>
                            </li>
                        
                    {% endfor %}
                </ul>
                

                <div class="row">
                    <div class="col-md-4 border border-1 p-4 rounded">
                        <h3 class="block-title mb-4">Your Addresses</h3>
                
                        {% if addressobj %}

                     <form action="{% url 'place_order'%}" method="POST"> {% csrf_token %}   

                        <select id="addressdropdown" name="address" class="form-control" >
							{% for item in addressobj  %}
							<option value="{{item.id}}">{{item.house}} -  {{item.district}} - {{item.state}} - {{item.country}} <br><br> </option>
							{% endfor %}
				
						</select> 

                    
                       
                        {% else %}
                        
                        <p class="no-address-message text-danger">No address added!</p>
                        {% endif %}
                        <br><br><br><br>
                        <a href="{% url 'addaddress'  %}" class="btn btn-info add-address-button">+ Add New Address</a>

                     {% comment %} </form> {% endcomment %}

                    </div>
                </div>
                
                <br><br><br>
                
            
            </div>
        </div>
        </div>
      </div>
    

    {% comment %} ###################################3 {% endcomment %}

   
       
    
     <div class="order-summary">
        <h3>Your Order Summary</h3>


        <div class="subtotal">
            <span>Subtotal:</span>
            <span class="subtotal-amount">{{total}}</span>
            <span>Discount</span>
            {% for k, v in category_offer.items %}
            {% if category_off == "No Offer" %}
                <div class="item-total"> {{ k }} Offer : {{ v }}% </div>
            {% else %}
                <div class="item-total"> {{ k }} Offer : {{ v }} </div>
            {% endif %}
            {% endfor %}
            <div class="item-total"> Category Offer rate: -{{ category_offer_rate | floatformat:2 }}</div>
            <div class="item-total"> Product Offer</div>
            {% for k,v in product_offer_values.items  %}
            {% if prod_off == "No Offer" %}
            <div class="item-total"> {{k}} Offer : {{v}}% </div>
            {% else %}
            <div class="item-total"> {{k}} Offer : {{v}} </div>
            {% endif %}
            {% endfor %}
            
            <div class="item-total"> Product Offer rate: -{{ product_offer_rate | floatformat:2 }}</div>

           

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-6 col-lg-5">
                <div class="order-details-confirmation">
                    <h3 class="block-title mb-4">Available coupons</h3>
         
                    {% comment %} {% if available_coupons %} {% endcomment %}
        
                    {% comment %} <form action="{% url 'checkout' %}" method="POST">
                        {% csrf_token %} {% endcomment %}
                        <div class="row justify-content-center">
                            <select id="couponid" name="coupons" class="form-control">
                                {% for item in available_coupons %}
                                
                                <option id="nil" data-category-id="{{item.id}}" value="{{item.code}}">{{item.code}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <br>
                        <div class="text-center mt-2">
                            <div  id = "applycoupon" class="btn btn-primary apply-button">Apply Coupon</div>
                        </div>
                    {% comment %} </form> {% endcomment %}
        
                    {% comment %} {% endif %}  {% endcomment %}
                </div>
            </div>
        </div>
    </div>
    
    
            <span>After discount:</span>
            {% comment %} <span class="subtotal-amount">{{subtotal}}</span> {% endcomment %}
            <span id = "totalamount" class="subtotal-amount">{{final_price | floatformat:2}}</span>
        </div>


    </div>

        
       
    
     <div class="payment-methods">
        <h3>Payment Methods</h3>
        <form action="{% url 'place_order' %}" method="POST">
            {% csrf_token %} 
            <input type="radio" name="payment_method" value="cash_on_delivery" id="cash_on_delivery">
            <label for="cash_on_delivery">Cash on Delivery</label>
            <br>
            <input type="radio" name="payment_method" value="razorpay" id="razorpay">
            <label for="razorpay">Razor Pay</label>
            
            <br>
            <input type="submit" class="btn razor-pay mr-3" value="PLACE ORDER">
        </form>
        <br><br>
    </div> 

    


                    
                
           
            
    <!-- ##### Checkout Area End ##### -->

    {% block custom_js %}
    
<script>
	{% for msg in messages %}
	swal({
		title: "Warning",
		text: '{{msg}}',
		icon: "warning",
		button: "Ok!",
	  });
	  {% endfor %}

</script>

      
      <button id="razorpay-payment-button">Pay with Razorpay</button>
      <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
      <script>
          var options = {
              key: 'your_api_key',
              amount: 1000,  // Amount in paisa (e.g., 1000 for ₹10)
              currency: 'INR',
              name: 'Your Company',
              description: 'Purchase Description',
              order_id: 'razorpay_order_id',  // Replace with the actual order ID obtained from the server
              handler: function(response) {
                  // Handle the successful payment here
                  // You can send the payment ID and other details to your server for verification
                  alert('Payment successful: ' + response.razorpay_payment_id);
              }
          };
      
          var rzp = new Razorpay(options);
          document.getElementById('razorpay-payment-button').onclick = function() {
              rzp.open();
          }
      </script>

    
    
      
	  


<script>
    $("#applycoupon").one("click",function(){
        if (firstclick==true) {
           return; // Exit the function if a request is already in progress
       }
       
       var firstclick=true;
       
       var couponid=$("#couponid").val();
       var totalamount=$("#totalamount").html()
       console.log(couponid,'dfjidsppppppppppppppppppppppppppppppppppppppp')
       $.ajax({
           url:"/applycouponajax/",
           type:"GET",
           data:{

               couponid:couponid,
               totalamount:totalamount
           },
           success:function(response){
               var discounted_amount=response.amount;
               //var couponmessage=response.message;
               $("#totalamount").html(discounted_amount);

               if (response.message_success){
                   $("#couponmessage").html(response.message_success +" &#x2713;").addClass("text-success");

               }
               else if(response.message){
                   $("#couponmessage").html(response.message).addClass("text-danger");

               }



               //$("#couponmessage").html(couponmessage);
               

           },
           error: function(xhr, status, error) {
               
               console.log(error);
             }





       })



   })
   
   


</script>


{% endblock custom_js %} 

{% endblock content%}
